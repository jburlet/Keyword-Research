<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dashboard de Posiciones SEO</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;700;800&family=Work+Sans:wght@400;500;600;700;800&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg: #f0f4f8;
  --ink: #0f172a;
  --muted: #64748b;
  --card: #ffffff;
  --line: #e2e8f0;
  --brand: #2563eb;
  --brand-light: #3b82f6;
  --green: #16a34a;
  --green-light: #22c55e;
  --red: #dc2626;
  --red-light: #ef4444;
  --yellow: #f59e0b;
  --yellow-light: #fbbf24;
  --purple: #8b5cf6;
  --purple-light: #a78bfa;
  --gold: #f59e0b;
  --silver: #64748b;
  --bronze: #d97706;
  --shadow-sm: 0 1px 3px rgba(0,0,0,.08);
  --shadow-md: 0 4px 6px rgba(0,0,0,.1);
  --shadow-lg: 0 10px 20px rgba(0,0,0,.15);
}

/* Theme: Professional Gray */
body[data-theme="gray"]{
  --bg: #f8fafc;
  --brand: #475569;
  --brand-light: #64748b;
  --green: #059669;
  --green-light: #10b981;
  --gold: #d97706;
}

/* Theme: Finance Green */
body[data-theme="finance"]{
  --bg: #f0fdf4;
  --brand: #047857;
  --brand-light: #059669;
  --green: #16a34a;
  --green-light: #22c55e;
  --gold: #ca8a04;
}

/* Theme: Executive Purple */
body[data-theme="executive"]{
  --bg: #faf5ff;
  --brand: #7c3aed;
  --brand-light: #8b5cf6;
  --green: #16a34a;
  --green-light: #22c55e;
  --gold: #d97706;
}

/* Theme: Tech Dark */
body[data-theme="dark"]{
  --bg: #0f172a;
  --ink: #f1f5f9;
  --muted: #cbd5e1;
  --card: #1e293b;
  --line: #334155;
  --brand: #3b82f6;
  --brand-light: #60a5fa;
  --green: #22c55e;
  --green-light: #4ade80;
  --gold: #fbbf24;
  --shadow-sm: 0 1px 3px rgba(0,0,0,.3);
  --shadow-md: 0 4px 6px rgba(0,0,0,.4);
  --shadow-lg: 0 10px 20px rgba(0,0,0,.5);
}
body[data-theme="dark"] .custom-select{
  background: var(--card);
  color: var(--ink);
  border-color: var(--line);
}
body[data-theme="dark"] .select-arrow{
  color: var(--muted);
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  background: var(--bg);
  color: var(--ink);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size: 14px;
  line-height: 1.7;
  min-height: 100vh;
  padding-top: 60px;
  transition: background .3s, color .3s;
  font-weight: 400;
  letter-spacing: -0.01em;
}
body[data-font="inter"]{font-family: 'Inter', sans-serif}
body[data-font="poppins"]{font-family: 'Poppins', sans-serif; letter-spacing: 0}
body[data-font="dmsans"]{font-family: 'DM Sans', sans-serif}
body[data-font="worksans"]{font-family: 'Work Sans', sans-serif}
body[data-font="manrope"]{font-family: 'Manrope', sans-serif}
.sticky-nav{position: fixed;top: 0;left: 0;right: 0;background: var(--card);backdrop-filter: blur(10px);border-bottom: 2px solid var(--line);padding: 12px 20px;z-index: 1000;box-shadow: var(--shadow-md);display: none}
.sticky-nav.show{display: block}
.nav-links{display: flex;gap: 16px;max-width: 1400px;margin: 0 auto;flex-wrap: wrap;justify-content: center}
.nav-link{padding: 8px 16px;background: var(--card);border: 2px solid var(--line);border-radius: 8px;font-weight: 700;font-size: 13px;color: var(--ink);cursor: pointer;transition: all .3s;text-decoration: none}
.nav-link:hover{background: var(--brand);color: white;border-color: var(--brand);transform: translateY(-2px)}
.wrap{max-width: 1400px;margin: 0 auto;padding: 20px 16px 80px}
.header-section{background: var(--card);backdrop-filter: blur(10px);border-radius: 20px;padding: 24px;margin-bottom: 20px;box-shadow: var(--shadow-lg);border: 2px solid var(--line)}
.row{display:flex;gap:16px;flex-wrap:wrap}
.between{justify-content:space-between;align-items:center}
.title{display: flex;gap: 12px;align-items: center;font-weight: 700;font-size: 32px;color: var(--ink);letter-spacing: -0.02em}
.title .emoji{font-size: 32px}
.subtitle{color: var(--muted);font-size: 14px;margin-top: 8px;font-weight: 500;letter-spacing: 0}
.theme-selector{display: flex;gap: 12px;align-items: center;margin-top: 16px;flex-wrap: wrap}
.theme-label{font-size: 11px;font-weight: 700;color: var(--muted);text-transform: uppercase;letter-spacing: 1px;margin-right: 4px}
.select-wrapper{position: relative;display: inline-block}
.custom-select{appearance: none;background: var(--card);border: 2px solid var(--line);border-radius: 10px;padding: 10px 40px 10px 16px;font-size: 13px;font-weight: 600;color: var(--ink);cursor: pointer;transition: all .3s;min-width: 160px}
.custom-select:hover{border-color: var(--brand);transform: translateY(-1px)}
.custom-select:focus{outline: none;border-color: var(--brand);box-shadow: 0 0 0 3px rgba(37,99,235,.1)}
.select-arrow{position: absolute;right: 14px;top: 50%;transform: translateY(-50%);pointer-events: none;color: var(--muted);font-size: 12px}
.btn{background: var(--card);border: 2px solid var(--line);color: var(--ink);padding: 10px 20px;border-radius: 12px;cursor: pointer;display: inline-flex;gap: 10px;align-items: center;font-weight: 600;font-size: 14px;transition: all .3s cubic-bezier(.4,0,.2,1);box-shadow: var(--shadow-sm)}
.btn:hover{transform: translateY(-2px);box-shadow: var(--shadow-md);border-color: var(--brand)}
.btn.primary{background: linear-gradient(135deg, var(--brand), var(--brand-light));border-color: var(--brand);color: white}
.btn.primary:hover{transform: translateY(-2px) scale(1.02);box-shadow: 0 8px 16px rgba(37,99,235,.3)}
input[type="file"]{display:none}
.empty-state h3{font-size: 20px;margin-bottom: 12px;color: var(--ink);font-weight: 600}
.card{background: var(--card);border: 2px solid var(--line);border-radius: 20px;padding: 20px;box-shadow: var(--shadow-md);transition: all .3s;margin-bottom: 20px}
.card:hover{box-shadow: var(--shadow-lg);transform: translateY(-2px)}
.kpi{flex: 1;min-width: 280px;position: relative;overflow: hidden;background: var(--card);border: 2px solid var(--line);transition: all .3s}
.kpi::before{content: '';position: absolute;top: 0;left: 0;width: 100%;height: 5px}
.kpi.gold::before{background: linear-gradient(90deg, #f59e0b, #fbbf24)}
.kpi.green::before{background: linear-gradient(90deg, var(--green), var(--green-light))}
.kpi.blue::before{background: linear-gradient(90deg, var(--brand), var(--brand-light))}
.kpi.yellow::before{background: linear-gradient(90deg, var(--yellow), var(--yellow-light))}
.kpi h5{margin: 0 0 12px;color: var(--muted);font-weight: 700;font-size: 11px;text-transform: uppercase;letter-spacing: 1.2px}
.kpi .big{font-size: 48px;font-weight: 800;line-height: 1;margin: 12px 0;color: var(--ink)}
.kpi .label{color: var(--muted);font-size: 13px;font-weight: 500}
.section-title{font-weight: 700;margin: 0 0 20px;font-size: 18px;color: var(--ink);display: flex;align-items: center;gap: 10px;letter-spacing: -0.01em}
.section-title .emoji{font-size: 22px}
.table-container{overflow-x: auto;margin-top: 16px}
.table{width: 100%;border-collapse: separate;border-spacing: 0;background: var(--card);border: 2px solid var(--line);border-radius: 16px;overflow: hidden}
.table th,.table td{padding: 14px 18px;border-bottom: 1px solid var(--line);font-size: 13px}
.table th{background: var(--card);color: var(--ink);font-weight: 700;text-align: left;text-transform: uppercase;font-size: 11px;letter-spacing: 1px;position: sticky;top: 0;z-index: 10;filter: brightness(0.96)}
.table tr:last-child td{border-bottom:0}
.table tbody tr{transition: all .2s}
.table tbody tr:hover{background: var(--line);opacity: 0.8}
.table tbody tr.top3{background: rgba(251,191,36,.2) !important;border-left: 4px solid var(--gold)}
.table tbody tr.top5{background: rgba(139,92,246,.15) !important;border-left: 4px solid var(--silver)}
.table tbody tr.top10{background: rgba(34,197,94,.15) !important;border-left: 4px solid var(--bronze)}
.position-badge{display: inline-flex;align-items: center;justify-content: center;background: var(--card);border: 2px solid var(--line);border-radius: 8px;padding: 6px 12px;font-weight: 700;font-size: 15px;min-width: 50px}
.position-badge.top3{background: rgba(251,191,36,.3);border-color: var(--gold);color: var(--ink);font-weight: 800}
.position-badge.top5{background: rgba(139,92,246,.25);border-color: var(--silver);color: var(--ink);font-weight: 800}
.position-badge.top10{background: rgba(34,197,94,.25);border-color: var(--bronze);color: var(--ink);font-weight: 800}
.keyword-cell{font-weight: 600;color: var(--ink);max-width: 400px}
.url-cell{color: var(--muted);font-size: 12px;max-width: 300px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;font-weight: 400}
.chart-cell{background: var(--card);border: 2px solid var(--line);border-radius: 16px;padding: 24px;box-shadow: var(--shadow-sm);margin-bottom: 20px}
.canvas-wrapper{width: 100%;height: 400px;position: relative}
.empty-state{text-align: center;padding: 60px 20px;color: var(--muted)}
.empty-state .emoji{font-size: 64px;margin-bottom: 20px;display: block}
.empty-state h3{font-size: 20px;margin-bottom: 12px;color: var(--ink)}
.drop-zone{cursor: pointer;transition: all .3s;border: 2px dashed var(--line) !important;background: var(--card) !important}
.drop-zone:hover{border-color: var(--green) !important;background: var(--card) !important;filter: brightness(0.97);transform: translateY(-2px)}
.drop-zone.drag-over{border-color: var(--green) !important;background: var(--card) !important;filter: brightness(0.94);transform: scale(1.02);box-shadow: 0 0 0 4px rgba(22,163,74,.15)}
.stats-grid{display: grid;grid-template-columns: repeat(auto-fit,minmax(200px,1fr));gap: 16px;margin-bottom: 24px}
.stat-card{background: var(--card);border: 2px solid var(--line);border-radius: 12px;padding: 20px;text-align: center}
.stat-card .number{font-size: 32px;font-weight: 700;color: var(--brand);margin: 8px 0}
.stat-card .label{font-size: 11px;font-weight: 700;color: var(--muted);text-transform: uppercase;letter-spacing: 1.2px}
.opportunities-section{background: var(--card);border: 2px solid var(--gold);border-radius: 16px;padding: 24px;margin-bottom: 20px}
.opportunities-section .section-title{color: var(--ink)}
.hidden{display:none}
.loading{text-align: center;padding: 40px;color: var(--muted)}
.loading::after{content: '...';animation: dots 1.5s infinite}
@keyframes dots{0%, 20%{content: '.'}40%{content: '..'}60%, 100%{content: '...'}}
.info-toggle{display: inline-flex;align-items: center;justify-content: center;width: 24px;height: 24px;border-radius: 50%;background: var(--brand);color: white;font-size: 14px;font-weight: 700;cursor: pointer;margin-left: 8px;transition: all .3s;border: none}
.info-toggle:hover{background: var(--brand-light);transform: scale(1.1)}
.info-box{background: var(--card);border: 2px solid var(--brand);border-radius: 12px;padding: 16px 20px;margin-top: 12px;display: none;animation: slideDown .3s ease-out;filter: brightness(0.98)}
.info-box.show{display: block}
.info-box h6{font-weight: 700;color: var(--brand);margin: 0 0 8px;font-size: 12px;text-transform: uppercase;letter-spacing: 0.8px}
.info-box p{margin: 0 0 8px;color: var(--ink);font-size: 13px;line-height: 1.7;font-weight: 400}
.info-box p:last-child{margin: 0}
.info-box strong{color: var(--brand);font-weight: 600}
@keyframes slideDown{from{opacity: 0;transform: translateY(-10px)}to{opacity: 1;transform: translateY(0)}}
.show-more-btn{background: linear-gradient(135deg, var(--brand), var(--brand-light));color: white;border: none;padding: 12px 24px;border-radius: 10px;font-weight: 700;font-size: 14px;cursor: pointer;margin: 16px auto 0;display: block;transition: all .3s;box-shadow: var(--shadow-sm)}
.show-more-btn:hover{transform: translateY(-2px);box-shadow: var(--shadow-md)}
.table-row-hidden{display: none}
</style>
</head>
<body>
<!-- Sticky Navigation -->
<nav id="stickyNav" class="sticky-nav">
  <div class="nav-links">
    <a class="nav-link" onclick="scrollToSection('kpis')">üìä KPIs</a>
    <a class="nav-link" onclick="scrollToSection('stats')">üìà Indicadores</a>
    <a class="nav-link" onclick="scrollToSection('opportunities')">üí° Oportunidades</a>
    <a class="nav-link" onclick="scrollToSection('distribution')">üìä Distribuci√≥n</a>
    <a class="nav-link" onclick="scrollToSection('keywords')">üîç Keywords</a>
  </div>
</nav>

<div class="wrap">
  <!-- File Input (hidden, outside empty state) -->
  <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display:none">
  
  <!-- Header -->
  <div class="header-section">
    <div class="row between">
      <div>
        <div class="title">
          <span class="emoji">üìä</span>
          <span>Dashboard de Posiciones SEO</span>
        </div>
        <div class="subtitle">An√°lisis de posicionamiento en Google</div>
        <div class="theme-selector">
          <span class="theme-label">Tema:</span>
          <div class="select-wrapper">
            <select id="themeSelect" class="custom-select" onchange="changeTheme(this.value)">
              <option value="default">Corporate Blue</option>
              <option value="gray">Professional Gray</option>
              <option value="finance">Finance Green</option>
              <option value="executive">Executive Purple</option>
              <option value="dark">Tech Dark</option>
            </select>
            <span class="select-arrow">‚ñº</span>
          </div>
          
          <span class="theme-label" style="margin-left: 24px">Fuente:</span>
          <div class="select-wrapper">
            <select id="fontSelect" class="custom-select" onchange="changeFont(this.value)">
              <option value="inter">Inter</option>
              <option value="poppins">Poppins</option>
              <option value="dmsans">DM Sans</option>
              <option value="worksans">Work Sans</option>
              <option value="manrope">Manrope</option>
            </select>
            <span class="select-arrow">‚ñº</span>
          </div>
          
          <span class="theme-label" style="margin-left: 24px">Idioma:</span>
          <div class="select-wrapper">
            <select id="langSelect" class="custom-select" onchange="changeLang(this.value)">
              <option value="es">Espa√±ol</option>
              <option value="en">English</option>
              <option value="pt">Portugu√™s</option>
            </select>
            <span class="select-arrow">‚ñº</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div id="emptyState" class="card drop-zone">
    <div class="empty-state">
      <span class="emoji">üì•</span>
      <h3>Arrastra tu archivo aqu√≠ o haz clic para cargar</h3>
      <p>Soporta archivos CSV y Excel con datos de keywords y posiciones</p>
      <button class="btn primary" style="margin-top: 20px" onclick="document.getElementById('fileInput').click()">
        <span>üìÅ</span>
        <span>Seleccionar archivo</span>
      </button>
    </div>
  </div>

  <!-- Main Content (hidden initially) -->
  <div id="mainContent" class="hidden">
    
    <!-- KPIs Info Section -->
    <div id="kpis" class="card" style="margin-bottom: 16px; scroll-margin-top: 80px">
      <div class="section-title">
        <span class="emoji">üìä</span>
        <span>M√©tricas Clave de Posicionamiento</span>
        <button class="info-toggle" onclick="toggleInfo('kpiInfo')">i</button>
      </div>
      <div id="kpiInfo" class="info-box">
        <h6>¬øQu√© son estas m√©tricas?</h6>
        <p>Estas m√©tricas muestran cu√°ntas keywords est√°n posicionadas en los rangos m√°s valiosos de Google. Las primeras posiciones generan exponencialmente m√°s tr√°fico que las posiciones inferiores.</p>
        <p><strong>Qu√© ponderar:</strong> Un portfolio saludable debe tener al menos 20-30% de keywords en TOP 10. Si ten√©s muchas keywords en posiciones 11-20, hay oportunidades claras de mejora con poco esfuerzo.</p>
      </div>
    </div>

    <!-- KPIs Section -->
    <div class="row" style="margin-bottom: 24px">
      <div class="card kpi gold">
        <h5>ü•á Keywords en TOP 3</h5>
        <div class="big" id="kpiTop3">0</div>
        <div class="label">Posiciones 1-3</div>
      </div>
      <div class="card kpi green">
        <h5>ü•à Keywords en TOP 5</h5>
        <div class="big" id="kpiTop5">0</div>
        <div class="label">Posiciones 1-5</div>
      </div>
      <div class="card kpi blue">
        <h5>ü•â Keywords en TOP 10</h5>
        <div class="big" id="kpiTop10">0</div>
        <div class="label">Posiciones 1-10</div>
      </div>
      <div class="card kpi yellow">
        <h5>üìà Total Keywords</h5>
        <div class="big" id="kpiTotal">0</div>
        <div class="label">En seguimiento</div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div id="stats" class="card" style="margin-bottom: 16px; scroll-margin-top: 80px">
      <div class="section-title" style="font-size: 16px">
        <span class="emoji">üìà</span>
        <span>Indicadores de Rendimiento</span>
        <button class="info-toggle" onclick="toggleInfo('statsInfo')">i</button>
      </div>
      <div id="statsInfo" class="info-box">
        <h6>¬øC√≥mo interpretar estos n√∫meros?</h6>
        <p><strong>Posici√≥n Promedio:</strong> Indica tu visibilidad general. Idealmente deber√≠a ser menor a 15. Si es mayor a 20, necesit√°s una estrategia de contenido m√°s agresiva.</p>
        <p><strong>Keywords en Primera P√°gina:</strong> Solo la primera p√°gina de Google genera tr√°fico significativo. Este n√∫mero deber√≠a crecer mes a mes.</p>
        <p><strong>Volumen Total (TOP 10):</strong> Representa el potencial de tr√°fico mensual de tus keywords mejor posicionadas. Este es el tr√°fico "ganado" de tu estrategia SEO.</p>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="label">Posici√≥n Promedio</div>
        <div class="number" id="avgPosition">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Mejor Posici√≥n</div>
        <div class="number" id="bestPosition">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Keywords en Primera P√°gina</div>
        <div class="number" id="firstPageCount">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Volumen Total (TOP 10)</div>
        <div class="number" id="volumeTop10">0</div>
      </div>
    </div>

    <!-- Opportunities Section -->
    <div id="opportunities" class="opportunities-section hidden" style="scroll-margin-top: 80px">
      <div class="section-title">
        <span class="emoji">üí°</span>
        <span>Oportunidades Cercanas al TOP 10</span>
        <button class="info-toggle" onclick="toggleInfo('oppInfo')">i</button>
      </div>
      <div id="oppInfo" class="info-box">
        <h6>üéØ Tu lista de acci√≥n prioritaria</h6>
        <p>Estas keywords est√°n a solo 1-5 posiciones de entrar al TOP 10. Son las oportunidades de <strong>mayor retorno con menor esfuerzo</strong>.</p>
        <p><strong>Acci√≥n recomendada:</strong> Optimiz√° el contenido de estas URLs, mejor√° enlaces internos hacia ellas, y consider√° actualizar el contenido para hacerlo m√°s completo que la competencia inmediata.</p>
        <p><strong>Impacto esperado:</strong> Mejorar estas posiciones puede incrementar el tr√°fico org√°nico entre 30-50% en 2-3 meses.</p>
      </div>
      <p style="margin-bottom: 16px; color: var(--muted); font-weight: 600">
        Keywords en posiciones 11-15 que con un poco de esfuerzo pueden entrar al TOP 10
      </p>
      <div id="opportunitiesList"></div>
    </div>

    <!-- Distribution Chart -->
    <div id="distribution" class="card chart-cell" style="scroll-margin-top: 80px">
      <div class="section-title">
        <span class="emoji">üìä</span>
        <span>Distribuci√≥n de Posiciones</span>
        <button class="info-toggle" onclick="toggleInfo('chartInfo')">i</button>
      </div>
      <div id="chartInfo" class="info-box">
        <h6>¬øQu√© te dice este gr√°fico?</h6>
        <p>Muestra c√≥mo se distribuyen tus keywords en diferentes rangos de posici√≥n. Una estrategia SEO saludable deber√≠a mostrar una distribuci√≥n tipo "pir√°mide" con m√°s keywords en posiciones altas.</p>
        <p><strong>Qu√© buscar:</strong> Si la mayor√≠a de tus keywords est√°n en posiciones 21+, necesit√°s mejorar la autoridad del sitio y la calidad del contenido. Si ten√©s muchas en 11-20, est√°s cerca de resultados significativos con optimizaciones puntuales.</p>
        <p><strong>Objetivo:</strong> Mes a mes, deber√≠as ver m√°s keywords movi√©ndose hacia la izquierda del gr√°fico (posiciones mejores).</p>
      </div>
      <div class="canvas-wrapper">
        <canvas id="distributionChart"></canvas>
      </div>
    </div>

    <!-- Keywords Table -->
    <div id="keywords" class="card" style="scroll-margin-top: 80px">
      <div class="section-title">
        <span class="emoji">üîç</span>
        <span>Todas las Keywords por Posici√≥n</span>
        <button class="info-toggle" onclick="toggleInfo('tableInfo')">i</button>
      </div>
      <div id="tableInfo" class="info-box">
        <h6>C√≥mo usar esta tabla</h6>
        <p>Listado completo de todas las keywords ordenadas por posici√≥n actual. Los colores indican el nivel de visibilidad:</p>
        <p><strong>ü•á Dorado (TOP 3):</strong> Keywords de alto valor. Proteg√© estas posiciones con contenido actualizado y enlaces de calidad.</p>
        <p><strong>ü•à P√∫rpura (TOP 5):</strong> Excelente visibilidad. Peque√±as mejoras pueden llevarlas al podio.</p>
        <p><strong>ü•â Verde (TOP 10):</strong> Primera p√°gina de Google. Monitore√° la competencia y manten√© el contenido relevante.</p>
        <p><strong>Acci√≥n:</strong> Export√° esta data mensualmente para trackear cambios y priorizar optimizaciones.</p>
      </div>
      <div class="table-container">
        <table class="table" id="keywordsTable">
          <thead>
            <tr>
              <th>Posici√≥n</th>
              <th>Keyword</th>
              <th>Volumen</th>
              <th>Tr√°fico Estimado</th>
              <th>URL</th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
        <div id="showMoreKeywords"></div>
      </div>
    </div>
  </div>
</div>

<script>
let globalData = [];
let distributionChart = null;
let currentLang = 'es';

// Translations
const translations = {
  es: {
    title: 'Dashboard de Posiciones SEO',
    subtitle: 'An√°lisis de posicionamiento en Google',
    themeLabel: 'Tema:',
    fontLabel: 'Fuente:',
    langLabel: 'Idioma:',
    themes: {
      default: 'Azul Corporativo',
      gray: 'Gris Profesional',
      finance: 'Verde Financiero',
      executive: 'P√∫rpura Ejecutivo',
      dark: 'Oscuro Tech'
    },
    emptyTitle: 'Arrastra tu archivo aqu√≠ o haz clic para cargar',
    emptyDesc: 'Soporta archivos CSV y Excel con datos de keywords y posiciones',
    selectFile: 'Seleccionar archivo',
    errorCsv: 'Error al leer el archivo CSV',
    errorExcel: 'Error al leer el archivo Excel',
    errorFormat: 'Formato de archivo no soportado. Por favor sube un archivo CSV o Excel.',
    errorNoData: 'No se encontraron datos v√°lidos en el archivo. Verifica que tenga las columnas correctas.',
    navKpis: 'üìä KPIs',
    navStats: 'üìà Indicadores',
    navOpp: 'üí° Oportunidades',
    navDist: 'üìä Distribuci√≥n',
    navKeywords: 'üîç Keywords',
    kpiSection: 'M√©tricas Clave de Posicionamiento',
    kpiInfoTitle: '¬øQu√© son estas m√©tricas?',
    kpiInfoDesc1: 'Estas m√©tricas muestran cu√°ntas keywords est√°n posicionadas en los rangos m√°s valiosos de Google. Las primeras posiciones generan exponencialmente m√°s tr√°fico que las posiciones inferiores.',
    kpiInfoDesc2: 'Qu√© ponderar:',
    kpiInfoDesc2b: ' Un portfolio saludable debe tener al menos 20-30% de keywords en TOP 10. Si ten√©s muchas keywords en posiciones 11-20, hay oportunidades claras de mejora con poco esfuerzo.',
    top3Label: 'ü•á Keywords en TOP 3',
    top3Sub: 'Posiciones 1-3',
    top5Label: 'ü•à Keywords en TOP 5',
    top5Sub: 'Posiciones 1-5',
    top10Label: 'ü•â Keywords en TOP 10',
    top10Sub: 'Posiciones 1-10',
    totalLabel: 'üìà Total Keywords',
    totalSub: 'En seguimiento',
    statsSection: 'Indicadores de Rendimiento',
    statsInfoTitle: '¬øC√≥mo interpretar estos n√∫meros?',
    statsInfoDesc1: 'Posici√≥n Promedio:',
    statsInfoDesc1b: ' Indica tu visibilidad general. Idealmente deber√≠a ser menor a 15. Si es mayor a 20, necesit√°s una estrategia de contenido m√°s agresiva.',
    statsInfoDesc2: 'Keywords en Primera P√°gina:',
    statsInfoDesc2b: ' Solo la primera p√°gina de Google genera tr√°fico significativo. Este n√∫mero deber√≠a crecer mes a mes.',
    statsInfoDesc3: 'Volumen Total (TOP 10):',
    statsInfoDesc3b: ' Representa el potencial de tr√°fico mensual de tus keywords mejor posicionadas. Este es el tr√°fico "ganado" de tu estrategia SEO.',
    avgPosLabel: 'Posici√≥n Promedio',
    bestPosLabel: 'Mejor Posici√≥n',
    firstPageLabel: 'Keywords en Primera P√°gina',
    volumeTop10Label: 'Volumen Total (TOP 10)',
    oppSection: 'Oportunidades Cercanas al TOP 10',
    oppInfoTitle: 'üéØ Tu lista de acci√≥n prioritaria',
    oppInfoDesc1: 'Estas keywords est√°n a solo 1-5 posiciones de entrar al TOP 10. Son las oportunidades de mayor retorno con menor esfuerzo.',
    oppInfoDesc2: 'Acci√≥n recomendada:',
    oppInfoDesc2b: ' Optimiz√° el contenido de estas URLs, mejor√° enlaces internos hacia ellas, y consider√° actualizar el contenido para hacerlo m√°s completo que la competencia inmediata.',
    oppInfoDesc3: 'Impacto esperado:',
    oppInfoDesc3b: ' Mejorar estas posiciones puede incrementar el tr√°fico org√°nico entre 30-50% en 2-3 meses.',
    oppDesc: 'Keywords en posiciones 11-15 que con un poco de esfuerzo pueden entrar al TOP 10',
    oppTablePos: 'Posici√≥n',
    oppTableKw: 'Keyword',
    oppTableVol: 'Volumen',
    oppTableDiff: 'Diferencia al TOP 10',
    oppTableDiffVal: 'posiciones',
    distSection: 'Distribuci√≥n de Posiciones',
    distInfoTitle: '¬øQu√© te dice este gr√°fico?',
    distInfoDesc1: 'Muestra c√≥mo se distribuyen tus keywords en diferentes rangos de posici√≥n. Una estrategia SEO saludable deber√≠a mostrar una distribuci√≥n tipo "pir√°mide" con m√°s keywords en posiciones altas.',
    distInfoDesc2: 'Qu√© buscar:',
    distInfoDesc2b: ' Si la mayor√≠a de tus keywords est√°n en posiciones 21+, necesit√°s mejorar la autoridad del sitio y la calidad del contenido. Si ten√©s muchas en 11-20, est√°s cerca de resultados significativos con optimizaciones puntuales.',
    distInfoDesc3: 'Objetivo:',
    distInfoDesc3b: ' Mes a mes, deber√≠as ver m√°s keywords movi√©ndose hacia la izquierda del gr√°fico (posiciones mejores).',
    kwSection: 'Todas las Keywords por Posici√≥n',
    kwInfoTitle: 'C√≥mo usar esta tabla',
    kwInfoDesc1: 'Listado completo de todas las keywords ordenadas por posici√≥n actual. Los colores indican el nivel de visibilidad:',
    kwInfoDesc2: 'ü•á Dorado (TOP 3):',
    kwInfoDesc2b: ' Keywords de alto valor. Proteg√© estas posiciones con contenido actualizado y enlaces de calidad.',
    kwInfoDesc3: 'ü•à P√∫rpura (TOP 5):',
    kwInfoDesc3b: ' Excelente visibilidad. Peque√±as mejoras pueden llevarlas al podio.',
    kwInfoDesc4: 'ü•â Verde (TOP 10):',
    kwInfoDesc4b: ' Primera p√°gina de Google. Monitore√° la competencia y manten√© el contenido relevante.',
    kwInfoDesc5: 'Acci√≥n:',
    kwInfoDesc5b: ' Export√° esta data mensualmente para trackear cambios y priorizar optimizaciones.',
    kwTablePos: 'Posici√≥n',
    kwTableKw: 'Keyword',
    kwTableVol: 'Volumen',
    kwTableTraffic: 'Tr√°fico Estimado',
    kwTableUrl: 'URL',
    showAll: 'Ver todas las',
    showAllOpp: 'oportunidades',
    showAllKw: 'keywords',
    chartLabel: 'Cantidad de Keywords'
  },
  en: {
    title: 'SEO Rankings Dashboard',
    subtitle: 'Google positioning analysis',
    themeLabel: 'Theme:',
    fontLabel: 'Font:',
    langLabel: 'Language:',
    themes: {
      default: 'Corporate Blue',
      gray: 'Professional Gray',
      finance: 'Finance Green',
      executive: 'Executive Purple',
      dark: 'Tech Dark'
    },
    emptyTitle: 'Drag your file here or click to upload',
    emptyDesc: 'Supports CSV and Excel files with keyword and position data',
    selectFile: 'Select file',
    errorCsv: 'Error reading CSV file',
    errorExcel: 'Error reading Excel file',
    errorFormat: 'Unsupported file format. Please upload a CSV or Excel file.',
    errorNoData: 'No valid data found in the file. Check that it has the correct columns.',
    navKpis: 'üìä KPIs',
    navStats: 'üìà Metrics',
    navOpp: 'üí° Opportunities',
    navDist: 'üìä Distribution',
    navKeywords: 'üîç Keywords',
    kpiSection: 'Key Positioning Metrics',
    kpiInfoTitle: 'What are these metrics?',
    kpiInfoDesc1: 'These metrics show how many keywords are ranked in the most valuable Google positions. Top positions generate exponentially more traffic than lower positions.',
    kpiInfoDesc2: 'What to consider:',
    kpiInfoDesc2b: ' A healthy portfolio should have at least 20-30% of keywords in TOP 10. If you have many keywords in positions 11-20, there are clear improvement opportunities with little effort.',
    top3Label: 'ü•á Keywords in TOP 3',
    top3Sub: 'Positions 1-3',
    top5Label: 'ü•à Keywords in TOP 5',
    top5Sub: 'Positions 1-5',
    top10Label: 'ü•â Keywords in TOP 10',
    top10Sub: 'Positions 1-10',
    totalLabel: 'üìà Total Keywords',
    totalSub: 'Being tracked',
    statsSection: 'Performance Indicators',
    statsInfoTitle: 'How to interpret these numbers?',
    statsInfoDesc1: 'Average Position:',
    statsInfoDesc1b: ' Indicates your overall visibility. Ideally should be less than 15. If greater than 20, you need a more aggressive content strategy.',
    statsInfoDesc2: 'Keywords on First Page:',
    statsInfoDesc2b: ' Only the first page of Google generates significant traffic. This number should grow month over month.',
    statsInfoDesc3: 'Total Volume (TOP 10):',
    statsInfoDesc3b: ' Represents the monthly traffic potential of your best-ranked keywords. This is the "earned" traffic from your SEO strategy.',
    avgPosLabel: 'Average Position',
    bestPosLabel: 'Best Position',
    firstPageLabel: 'Keywords on First Page',
    volumeTop10Label: 'Total Volume (TOP 10)',
    oppSection: 'Opportunities Near TOP 10',
    oppInfoTitle: 'üéØ Your priority action list',
    oppInfoDesc1: 'These keywords are only 1-5 positions away from entering TOP 10. They are the highest return opportunities with the least effort.',
    oppInfoDesc2: 'Recommended action:',
    oppInfoDesc2b: ' Optimize the content of these URLs, improve internal links to them, and consider updating content to make it more complete than immediate competition.',
    oppInfoDesc3: 'Expected impact:',
    oppInfoDesc3b: ' Improving these positions can increase organic traffic by 30-50% in 2-3 months.',
    oppDesc: 'Keywords in positions 11-15 that with a little effort can enter TOP 10',
    oppTablePos: 'Position',
    oppTableKw: 'Keyword',
    oppTableVol: 'Volume',
    oppTableDiff: 'Distance to TOP 10',
    oppTableDiffVal: 'positions',
    distSection: 'Position Distribution',
    distInfoTitle: 'What does this chart tell you?',
    distInfoDesc1: 'Shows how your keywords are distributed across different position ranges. A healthy SEO strategy should show a "pyramid" distribution with more keywords in top positions.',
    distInfoDesc2: 'What to look for:',
    distInfoDesc2b: ' If most of your keywords are in positions 21+, you need to improve site authority and content quality. If you have many in 11-20, you\'re close to significant results with targeted optimizations.',
    distInfoDesc3: 'Goal:',
    distInfoDesc3b: ' Month over month, you should see more keywords moving to the left of the chart (better positions).',
    kwSection: 'All Keywords by Position',
    kwInfoTitle: 'How to use this table',
    kwInfoDesc1: 'Complete list of all keywords sorted by current position. Colors indicate visibility level:',
    kwInfoDesc2: 'ü•á Gold (TOP 3):',
    kwInfoDesc2b: ' High-value keywords. Protect these positions with updated content and quality links.',
    kwInfoDesc3: 'ü•à Purple (TOP 5):',
    kwInfoDesc3b: ' Excellent visibility. Small improvements can take them to the podium.',
    kwInfoDesc4: 'ü•â Green (TOP 10):',
    kwInfoDesc4b: ' First page of Google. Monitor competition and keep content relevant.',
    kwInfoDesc5: 'Action:',
    kwInfoDesc5b: ' Export this data monthly to track changes and prioritize optimizations.',
    kwTablePos: 'Position',
    kwTableKw: 'Keyword',
    kwTableVol: 'Volume',
    kwTableTraffic: 'Estimated Traffic',
    kwTableUrl: 'URL',
    showAll: 'View all',
    showAllOpp: 'opportunities',
    showAllKw: 'keywords',
    chartLabel: 'Number of Keywords'
  },
  pt: {
    title: 'Dashboard de Posi√ß√µes SEO',
    subtitle: 'An√°lise de posicionamento no Google',
    themeLabel: 'Tema:',
    fontLabel: 'Fonte:',
    langLabel: 'Idioma:',
    themes: {
      default: 'Azul Corporativo',
      gray: 'Cinza Profissional',
      finance: 'Verde Financeiro',
      executive: 'Roxo Executivo',
      dark: 'Escuro Tech'
    },
    emptyTitle: 'Arraste seu arquivo aqui ou clique para carregar',
    emptyDesc: 'Suporta arquivos CSV e Excel com dados de palavras-chave e posi√ß√µes',
    selectFile: 'Selecionar arquivo',
    errorCsv: 'Erro ao ler o arquivo CSV',
    errorExcel: 'Erro ao ler o arquivo Excel',
    errorFormat: 'Formato de arquivo n√£o suportado. Por favor, carregue um arquivo CSV ou Excel.',
    errorNoData: 'Nenhum dado v√°lido encontrado no arquivo. Verifique se ele possui as colunas corretas.',
    navKpis: 'üìä KPIs',
    navStats: 'üìà Indicadores',
    navOpp: 'üí° Oportunidades',
    navDist: 'üìä Distribui√ß√£o',
    navKeywords: 'üîç Palavras-chave',
    kpiSection: 'M√©tricas Principais de Posicionamento',
    kpiInfoTitle: 'O que s√£o essas m√©tricas?',
    kpiInfoDesc1: 'Essas m√©tricas mostram quantas palavras-chave est√£o posicionadas nas faixas mais valiosas do Google. As primeiras posi√ß√µes geram exponencialmente mais tr√°fego do que as posi√ß√µes inferiores.',
    kpiInfoDesc2: 'O que considerar:',
    kpiInfoDesc2b: ' Um portf√≥lio saud√°vel deve ter pelo menos 20-30% das palavras-chave no TOP 10. Se voc√™ tem muitas palavras-chave nas posi√ß√µes 11-20, h√° oportunidades claras de melhoria com pouco esfor√ßo.',
    top3Label: 'ü•á Palavras-chave no TOP 3',
    top3Sub: 'Posi√ß√µes 1-3',
    top5Label: 'ü•à Palavras-chave no TOP 5',
    top5Sub: 'Posi√ß√µes 1-5',
    top10Label: 'ü•â Palavras-chave no TOP 10',
    top10Sub: 'Posi√ß√µes 1-10',
    totalLabel: 'üìà Total de Palavras-chave',
    totalSub: 'Em monitoramento',
    statsSection: 'Indicadores de Desempenho',
    statsInfoTitle: 'Como interpretar esses n√∫meros?',
    statsInfoDesc1: 'Posi√ß√£o M√©dia:',
    statsInfoDesc1b: ' Indica sua visibilidade geral. Idealmente deve ser menor que 15. Se for maior que 20, voc√™ precisa de uma estrat√©gia de conte√∫do mais agressiva.',
    statsInfoDesc2: 'Palavras-chave na Primeira P√°gina:',
    statsInfoDesc2b: ' Apenas a primeira p√°gina do Google gera tr√°fego significativo. Este n√∫mero deve crescer m√™s a m√™s.',
    statsInfoDesc3: 'Volume Total (TOP 10):',
    statsInfoDesc3b: ' Representa o potencial de tr√°fego mensal de suas palavras-chave melhor posicionadas. Este √© o tr√°fego "conquistado" de sua estrat√©gia SEO.',
    avgPosLabel: 'Posi√ß√£o M√©dia',
    bestPosLabel: 'Melhor Posi√ß√£o',
    firstPageLabel: 'Palavras-chave na Primeira P√°gina',
    volumeTop10Label: 'Volume Total (TOP 10)',
    oppSection: 'Oportunidades Pr√≥ximas ao TOP 10',
    oppInfoTitle: 'üéØ Sua lista de a√ß√£o priorit√°ria',
    oppInfoDesc1: 'Essas palavras-chave est√£o a apenas 1-5 posi√ß√µes de entrar no TOP 10. S√£o as oportunidades de maior retorno com menor esfor√ßo.',
    oppInfoDesc2: 'A√ß√£o recomendada:',
    oppInfoDesc2b: ' Otimize o conte√∫do dessas URLs, melhore os links internos para elas e considere atualizar o conte√∫do para torn√°-lo mais completo do que a concorr√™ncia imediata.',
    oppInfoDesc3: 'Impacto esperado:',
    oppInfoDesc3b: ' Melhorar essas posi√ß√µes pode aumentar o tr√°fego org√¢nico entre 30-50% em 2-3 meses.',
    oppDesc: 'Palavras-chave nas posi√ß√µes 11-15 que com um pouco de esfor√ßo podem entrar no TOP 10',
    oppTablePos: 'Posi√ß√£o',
    oppTableKw: 'Palavra-chave',
    oppTableVol: 'Volume',
    oppTableDiff: 'Diferen√ßa para o TOP 10',
    oppTableDiffVal: 'posi√ß√µes',
    distSection: 'Distribui√ß√£o de Posi√ß√µes',
    distInfoTitle: 'O que este gr√°fico lhe diz?',
    distInfoDesc1: 'Mostra como suas palavras-chave est√£o distribu√≠das em diferentes faixas de posi√ß√£o. Uma estrat√©gia SEO saud√°vel deve mostrar uma distribui√ß√£o tipo "pir√¢mide" com mais palavras-chave em posi√ß√µes altas.',
    distInfoDesc2: 'O que procurar:',
    distInfoDesc2b: ' Se a maioria de suas palavras-chave est√° em posi√ß√µes 21+, voc√™ precisa melhorar a autoridade do site e a qualidade do conte√∫do. Se voc√™ tem muitas em 11-20, est√° perto de resultados significativos com otimiza√ß√µes pontuais.',
    distInfoDesc3: 'Objetivo:',
    distInfoDesc3b: ' M√™s a m√™s, voc√™ deve ver mais palavras-chave se movendo para a esquerda do gr√°fico (melhores posi√ß√µes).',
    kwSection: 'Todas as Palavras-chave por Posi√ß√£o',
    kwInfoTitle: 'Como usar esta tabela',
    kwInfoDesc1: 'Lista completa de todas as palavras-chave ordenadas por posi√ß√£o atual. As cores indicam o n√≠vel de visibilidade:',
    kwInfoDesc2: 'ü•á Dourado (TOP 3):',
    kwInfoDesc2b: ' Palavras-chave de alto valor. Proteja essas posi√ß√µes com conte√∫do atualizado e links de qualidade.',
    kwInfoDesc3: 'ü•à Roxo (TOP 5):',
    kwInfoDesc3b: ' Excelente visibilidade. Pequenas melhorias podem lev√°-las ao p√≥dio.',
    kwInfoDesc4: 'ü•â Verde (TOP 10):',
    kwInfoDesc4b: ' Primeira p√°gina do Google. Monitore a concorr√™ncia e mantenha o conte√∫do relevante.',
    kwInfoDesc5: 'A√ß√£o:',
    kwInfoDesc5b: ' Exporte esses dados mensalmente para rastrear mudan√ßas e priorizar otimiza√ß√µes.',
    kwTablePos: 'Posi√ß√£o',
    kwTableKw: 'Palavra-chave',
    kwTableVol: 'Volume',
    kwTableTraffic: 'Tr√°fego Estimado',
    kwTableUrl: 'URL',
    showAll: 'Ver todas as',
    showAllOpp: 'oportunidades',
    showAllKw: 'palavras-chave',
    chartLabel: 'Quantidade de Palavras-chave'
  }
};

// Language management
function changeLang(lang) {
  currentLang = lang;
  const t = translations[lang];
  
  // Update select value
  const langSelect = document.getElementById('langSelect');
  if (langSelect) {
    langSelect.value = lang;
  }
  
  // Update all text content
  document.querySelector('.title span:not(.emoji)').textContent = t.title;
  document.querySelector('.subtitle').textContent = t.subtitle;
  
  // Update theme dropdown options
  const themeSelect = document.getElementById('themeSelect');
  if (themeSelect) {
    themeSelect.options[0].text = t.themes.default;
    themeSelect.options[1].text = t.themes.gray;
    themeSelect.options[2].text = t.themes.finance;
    themeSelect.options[3].text = t.themes.executive;
    themeSelect.options[4].text = t.themes.dark;
  }
  
  // Save preference
  localStorage.setItem('dashboard-lang', lang);
  
  // Re-render content if data exists
  if (globalData.length > 0) {
    updateAllSections();
  } else {
    updateEmptyState();
  }
}

function updateEmptyState() {
  const t = translations[currentLang];
  const emptyState = document.getElementById('emptyState');
  if (emptyState && !emptyState.classList.contains('hidden')) {
    emptyState.querySelector('h3').textContent = t.emptyTitle;
    emptyState.querySelector('p').textContent = t.emptyDesc;
    emptyState.querySelector('.btn span:last-child').textContent = t.selectFile;
  }
}

function updateAllSections() {
  const t = translations[currentLang];
  
  // Update nav
  const navLinks = document.querySelectorAll('.nav-link');
  if (navLinks.length > 0) {
    navLinks[0].textContent = t.navKpis;
    navLinks[1].textContent = t.navStats;
    navLinks[2].textContent = t.navOpp;
    navLinks[3].textContent = t.navDist;
    navLinks[4].textContent = t.navKeywords;
  }
  
  // Update section titles and info boxes
  updateKPISection();
  updateStatsSection();
  updateOpportunitiesSection();
  updateDistributionSection();
  updateKeywordsSection();
  
  // Re-render visualizations
  updateKPIs();
  updateStatsGrid();
  updateOpportunities();
  updateDistributionChart();
  updateTable();
}

function updateKPISection() {
  const t = translations[currentLang];
  document.querySelector('#kpis .section-title span:not(.emoji)').textContent = t.kpiSection;
  document.querySelector('#kpiInfo h6').textContent = t.kpiInfoTitle;
  const kpiInfoPs = document.querySelectorAll('#kpiInfo p');
  kpiInfoPs[0].textContent = t.kpiInfoDesc1;
  kpiInfoPs[1].innerHTML = `<strong>${t.kpiInfoDesc2}</strong>${t.kpiInfoDesc2b}`;
  
  document.querySelectorAll('.kpi h5')[0].textContent = t.top3Label;
  document.querySelectorAll('.kpi .label')[0].textContent = t.top3Sub;
  document.querySelectorAll('.kpi h5')[1].textContent = t.top5Label;
  document.querySelectorAll('.kpi .label')[1].textContent = t.top5Sub;
  document.querySelectorAll('.kpi h5')[2].textContent = t.top10Label;
  document.querySelectorAll('.kpi .label')[2].textContent = t.top10Sub;
  document.querySelectorAll('.kpi h5')[3].textContent = t.totalLabel;
  document.querySelectorAll('.kpi .label')[3].textContent = t.totalSub;
}

function updateStatsSection() {
  const t = translations[currentLang];
  document.querySelector('#stats .section-title span:not(.emoji)').textContent = t.statsSection;
  document.querySelector('#statsInfo h6').textContent = t.statsInfoTitle;
  const statsInfoPs = document.querySelectorAll('#statsInfo p');
  statsInfoPs[0].innerHTML = `<strong>${t.statsInfoDesc1}</strong>${t.statsInfoDesc1b}`;
  statsInfoPs[1].innerHTML = `<strong>${t.statsInfoDesc2}</strong>${t.statsInfoDesc2b}`;
  statsInfoPs[2].innerHTML = `<strong>${t.statsInfoDesc3}</strong>${t.statsInfoDesc3b}`;
  
  document.querySelectorAll('.stat-card .label')[0].textContent = t.avgPosLabel;
  document.querySelectorAll('.stat-card .label')[1].textContent = t.bestPosLabel;
  document.querySelectorAll('.stat-card .label')[2].textContent = t.firstPageLabel;
  document.querySelectorAll('.stat-card .label')[3].textContent = t.volumeTop10Label;
}

function updateOpportunitiesSection() {
  const t = translations[currentLang];
  const oppSection = document.querySelector('#opportunities .section-title span:not(.emoji)');
  if (oppSection) {
    oppSection.textContent = t.oppSection;
  }
  const oppInfo = document.querySelector('#oppInfo h6');
  if (oppInfo) {
    oppInfo.textContent = t.oppInfoTitle;
    const oppInfoPs = document.querySelectorAll('#oppInfo p');
    oppInfoPs[0].innerHTML = `${t.oppInfoDesc1.replace('mayor retorno con menor esfuerzo', `<strong>${t.oppInfoDesc1.match(/mayor retorno con menor esfuerzo|highest return.*least effort|maior retorno com menor esfor√ßo/)?.[0] || 'mayor retorno con menor esfuerzo'}</strong>`)}`;
    oppInfoPs[1].innerHTML = `<strong>${t.oppInfoDesc2}</strong>${t.oppInfoDesc2b}`;
    oppInfoPs[2].innerHTML = `<strong>${t.oppInfoDesc3}</strong>${t.oppInfoDesc3b}`;
  }
}

function updateDistributionSection() {
  const t = translations[currentLang];
  document.querySelector('#distribution .section-title span:not(.emoji)').textContent = t.distSection;
  document.querySelector('#chartInfo h6').textContent = t.distInfoTitle;
  const chartInfoPs = document.querySelectorAll('#chartInfo p');
  chartInfoPs[0].textContent = t.distInfoDesc1;
  chartInfoPs[1].innerHTML = `<strong>${t.distInfoDesc2}</strong>${t.distInfoDesc2b}`;
  chartInfoPs[2].innerHTML = `<strong>${t.distInfoDesc3}</strong>${t.distInfoDesc3b}`;
}

function updateKeywordsSection() {
  const t = translations[currentLang];
  document.querySelector('#keywords .section-title span:not(.emoji)').textContent = t.kwSection;
  document.querySelector('#tableInfo h6').textContent = t.kwInfoTitle;
  const tableInfoPs = document.querySelectorAll('#tableInfo p');
  tableInfoPs[0].textContent = t.kwInfoDesc1;
  tableInfoPs[1].innerHTML = `<strong>${t.kwInfoDesc2}</strong>${t.kwInfoDesc2b}`;
  tableInfoPs[2].innerHTML = `<strong>${t.kwInfoDesc3}</strong>${t.kwInfoDesc3b}`;
  tableInfoPs[3].innerHTML = `<strong>${t.kwInfoDesc4}</strong>${t.kwInfoDesc4b}`;
  tableInfoPs[4].innerHTML = `<strong>${t.kwInfoDesc5}</strong>${t.kwInfoDesc5b}`;
}

// Theme management
function changeTheme(theme) {
  document.body.setAttribute('data-theme', theme);
  
  // Update select value
  const themeSelect = document.getElementById('themeSelect');
  if (themeSelect) {
    themeSelect.value = theme;
  }
  
  // Save preference
  localStorage.setItem('dashboard-theme', theme);
  
  // Re-render chart if it exists
  if (distributionChart && globalData.length > 0) {
    updateDistributionChart();
  }
}

// Load saved theme on page load
window.addEventListener('DOMContentLoaded', function() {
  const savedTheme = localStorage.getItem('dashboard-theme') || 'default';
  const savedFont = localStorage.getItem('dashboard-font') || 'inter';
  const savedLang = localStorage.getItem('dashboard-lang') || 'es';
  
  changeTheme(savedTheme);
  changeFont(savedFont);
  changeLang(savedLang);
});

// Font management
function changeFont(font) {
  document.body.setAttribute('data-font', font);
  
  // Update select value
  const fontSelect = document.getElementById('fontSelect');
  if (fontSelect) {
    fontSelect.value = font;
  }
  
  // Save preference
  localStorage.setItem('dashboard-font', font);
  
  // Re-render chart if it exists to update fonts
  if (distributionChart && globalData.length > 0) {
    updateDistributionChart();
  }
}

// Scroll to section
function scrollToSection(id) {
  const element = document.getElementById(id);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// Show sticky nav on scroll
window.addEventListener('scroll', function() {
  const stickyNav = document.getElementById('stickyNav');
  const mainContent = document.getElementById('mainContent');
  
  if (mainContent && !mainContent.classList.contains('hidden')) {
    if (window.scrollY > 300) {
      stickyNav.classList.add('show');
    } else {
      stickyNav.classList.remove('show');
    }
  }
});

// Toggle info boxes
function toggleInfo(id) {
  const infoBox = document.getElementById(id);
  infoBox.classList.toggle('show');
}

// File input handler
document.getElementById('fileInput').addEventListener('change', handleFileUpload);

function handleFileUpload(e) {
  const file = e.target.files[0];
  if (file) {
    handleFile(file);
  }
}

// Drag and drop for empty state
const emptyState = document.getElementById('emptyState');

if (emptyState) {
  emptyState.addEventListener('click', function() {
    document.getElementById('fileInput').click();
  });

  emptyState.addEventListener('dragover', function(e) {
    e.preventDefault();
    e.stopPropagation();
    emptyState.classList.add('drag-over');
  });

  emptyState.addEventListener('dragleave', function(e) {
    e.preventDefault();
    e.stopPropagation();
    emptyState.classList.remove('drag-over');
  });

  emptyState.addEventListener('drop', function(e) {
    e.preventDefault();
    e.stopPropagation();
    emptyState.classList.remove('drag-over');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleFile(files[0]);
    }
  });
}

function handleFileUpload(e) {
  const file = e.target.files[0];
  if (file) handleFile(file);
}

function handleFile(file) {

  const fileName = file.name.toLowerCase();
  
  if (fileName.endsWith('.csv')) {
    Papa.parse(file, {
      header: true,
      encoding: 'UTF-16LE',
      skipEmptyLines: true,
      complete: function(results) {
        processData(results.data);
      },
      error: function(error) {
        alert('Error al leer el archivo CSV: ' + error.message);
      }
    });
  } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
        processData(jsonData);
      } catch(error) {
        alert('Error al leer el archivo Excel: ' + error.message);
      }
    };
    reader.readAsArrayBuffer(file);
  }
}

function processData(data) {
  const t = translations[currentLang];
  // Clean and prepare data
  globalData = data
    .map(row => {
      // Handle both possible column name formats
      const position = parseInt(row['Current position'] || row['Posici√≥n actual'] || row.Position || 0);
      const keyword = row['Keyword'] || row['Palabra clave'] || '';
      const volume = parseInt(row['Volume'] || row['Volumen'] || 0);
      const traffic = parseInt(row['Organic traffic'] || row['Tr√°fico org√°nico'] || 0);
      const url = row['Current URL'] || row['URL actual'] || '';
      
      return {
        keyword: keyword,
        position: position,
        volume: volume,
        traffic: traffic,
        url: url
      };
    })
    .filter(row => row.keyword && row.position > 0)
    .sort((a, b) => a.position - b.position);

  if (globalData.length === 0) {
    alert(t.errorNoData);
    return;
  }

  // Hide empty state, show content
  document.getElementById('emptyState').classList.add('hidden');
  document.getElementById('mainContent').classList.remove('hidden');

  // Update all visualizations
  updateAllSections();
}

function updateKPIs() {
  const top3 = globalData.filter(k => k.position <= 3).length;
  const top5 = globalData.filter(k => k.position <= 5).length;
  const top10 = globalData.filter(k => k.position <= 10).length;
  const total = globalData.length;

  document.getElementById('kpiTop3').textContent = top3;
  document.getElementById('kpiTop5').textContent = top5;
  document.getElementById('kpiTop10').textContent = top10;
  document.getElementById('kpiTotal').textContent = total;
}

function updateStatsGrid() {
  // Average position
  const avgPos = globalData.reduce((sum, k) => sum + k.position, 0) / globalData.length;
  document.getElementById('avgPosition').textContent = avgPos.toFixed(1);

  // Best position
  const bestPos = Math.min(...globalData.map(k => k.position));
  document.getElementById('bestPosition').textContent = bestPos;

  // First page count (1-10)
  const firstPage = globalData.filter(k => k.position <= 10).length;
  document.getElementById('firstPageCount').textContent = firstPage;

  // Volume in TOP 10
  const volumeTop10 = globalData
    .filter(k => k.position <= 10)
    .reduce((sum, k) => sum + k.volume, 0);
  document.getElementById('volumeTop10').textContent = formatNumber(volumeTop10);
}

function updateOpportunities() {
  const t = translations[currentLang];
  const opportunities = globalData.filter(k => k.position >= 11 && k.position <= 15);
  
  if (opportunities.length === 0) {
    document.getElementById('opportunities').classList.add('hidden');
    return;
  }

  document.getElementById('opportunities').classList.remove('hidden');
  
  const limitRows = 5;
  const showAll = opportunities.length <= limitRows;
  
  const html = `
    <table class="table">
      <thead>
        <tr>
          <th>${t.oppTablePos}</th>
          <th>${t.oppTableKw}</th>
          <th>${t.oppTableVol}</th>
          <th>${t.oppTableDiff}</th>
        </tr>
      </thead>
      <tbody id="oppTableBody">
        ${opportunities.map((k, index) => `
          <tr class="${index >= limitRows ? 'table-row-hidden' : ''}" data-row-index="${index}">
            <td><span class="position-badge">${k.position}</span></td>
            <td class="keyword-cell">${k.keyword}</td>
            <td>${formatNumber(k.volume)}</td>
            <td style="font-weight: 700; color: var(--yellow)">-${k.position - 10} ${t.oppTableDiffVal}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
    ${!showAll ? `<button class="show-more-btn" onclick="showAllRows('oppTableBody', ${opportunities.length})">${t.showAll} ${opportunities.length} ${t.showAllOpp} ‚ñº</button>` : ''}
  `;
  
  document.getElementById('opportunitiesList').innerHTML = html;
}

function updateDistributionChart() {
  // Group by position ranges
  const ranges = {
    '1-3': globalData.filter(k => k.position <= 3).length,
    '4-5': globalData.filter(k => k.position >= 4 && k.position <= 5).length,
    '6-10': globalData.filter(k => k.position >= 6 && k.position <= 10).length,
    '11-20': globalData.filter(k => k.position >= 11 && k.position <= 20).length,
    '21-50': globalData.filter(k => k.position >= 21 && k.position <= 50).length,
    '51+': globalData.filter(k => k.position > 50).length
  };

  const ctx = document.getElementById('distributionChart').getContext('2d');
  
  if (distributionChart) {
    distributionChart.destroy();
  }

  distributionChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(ranges),
      datasets: [{
        label: 'Cantidad de Keywords',
        data: Object.values(ranges),
        backgroundColor: [
          'rgba(251, 191, 36, 0.8)',  // Gold for 1-3
          'rgba(139, 92, 246, 0.8)',  // Purple for 4-5
          'rgba(34, 197, 94, 0.8)',   // Green for 6-10
          'rgba(37, 99, 235, 0.8)',   // Blue for 11-20
          'rgba(245, 158, 11, 0.8)',  // Orange for 21-50
          'rgba(100, 116, 139, 0.8)'  // Gray for 51+
        ],
        borderColor: [
          'rgb(251, 191, 36)',
          'rgb(139, 92, 246)',
          'rgb(34, 197, 94)',
          'rgb(37, 99, 235)',
          'rgb(245, 158, 11)',
          'rgb(100, 116, 139)'
        ],
        borderWidth: 2,
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(15, 23, 42, 0.95)',
          padding: 12,
          titleFont: {
            size: 14,
            weight: 'bold'
          },
          bodyFont: {
            size: 13
          },
          borderColor: 'rgba(226, 232, 240, 0.2)',
          borderWidth: 1,
          callbacks: {
            label: function(context) {
              const total = globalData.length;
              const value = context.parsed.y;
              const percentage = ((value / total) * 100).toFixed(1);
              return `${value} keywords (${percentage}%)`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            precision: 0,
            font: {
              size: 12,
              weight: '600'
            }
          },
          grid: {
            color: 'rgba(226, 232, 240, 0.5)'
          }
        },
        x: {
          ticks: {
            font: {
              size: 13,
              weight: '700'
            }
          },
          grid: {
            display: false
          }
        }
      }
    }
  });
}

function updateTable() {
  const t = translations[currentLang];
  const tbody = document.getElementById('tableBody');
  const showMoreContainer = document.getElementById('showMoreKeywords');
  const limitRows = 10;
  const showAll = globalData.length <= limitRows;
  
  // Update table headers
  const tableHeaders = document.querySelectorAll('#keywordsTable thead th');
  if (tableHeaders.length > 0) {
    tableHeaders[0].textContent = t.kwTablePos;
    tableHeaders[1].textContent = t.kwTableKw;
    tableHeaders[2].textContent = t.kwTableVol;
    tableHeaders[3].textContent = t.kwTableTraffic;
    tableHeaders[4].textContent = t.kwTableUrl;
  }
  
  const html = globalData.map((k, index) => {
    let rowClass = '';
    let badgeClass = '';
    
    if (k.position <= 3) {
      rowClass = 'top3';
      badgeClass = 'top3';
    } else if (k.position <= 5) {
      rowClass = 'top5';
      badgeClass = 'top5';
    } else if (k.position <= 10) {
      rowClass = 'top10';
      badgeClass = 'top10';
    }
    
    return `
      <tr class="${rowClass} ${index >= limitRows ? 'table-row-hidden' : ''}" data-row-index="${index}">
        <td><span class="position-badge ${badgeClass}">${k.position}</span></td>
        <td class="keyword-cell">${k.keyword}</td>
        <td>${formatNumber(k.volume)}</td>
        <td>${formatNumber(k.traffic)}</td>
        <td class="url-cell" title="${k.url}">${k.url}</td>
      </tr>
    `;
  }).join('');
  
  tbody.innerHTML = html;
  
  // Add "Show more" button if needed
  if (!showAll) {
    showMoreContainer.innerHTML = `<button class="show-more-btn" onclick="showAllRows('tableBody', ${globalData.length})">${t.showAll} ${globalData.length} ${t.showAllKw} ‚ñº</button>`;
  } else {
    showMoreContainer.innerHTML = '';
  }
}

function formatNumber(num) {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
}

function showAllRows(tbodyId, totalRows) {
  const tbody = document.getElementById(tbodyId);
  const hiddenRows = tbody.querySelectorAll('.table-row-hidden');
  
  hiddenRows.forEach(row => {
    row.classList.remove('table-row-hidden');
  });
  
  // Remove the button
  const btn = event.target;
  if (btn.parentElement.id === 'showMoreKeywords') {
    document.getElementById('showMoreKeywords').innerHTML = '';
  } else {
    btn.parentElement.remove();
  }
}
</script>
</body>
</html>
